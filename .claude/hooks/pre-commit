#!/usr/bin/env bash
# Claude pre-commit hook - Runs before Claude commits changes

echo "ğŸ” Running Claude pre-commit checks..."

# Check if we're in the right directory
if [ ! -f "package.json" ]; then
    echo "âŒ Error: Not in project root directory"
    exit 1
fi

# Run TypeScript type checking
echo "ğŸ“ Checking TypeScript types..."
pnpm run type-check
if [ $? -ne 0 ]; then
    echo "âŒ TypeScript type errors found. Please fix before committing."
    exit 1
fi

# Run linting
echo "ğŸ§¹ Running ESLint..."
pnpm run lint
if [ $? -ne 0 ]; then
    echo "âŒ Linting errors found. Attempting auto-fix..."
    pnpm run lint:fix
    echo "âœ… Auto-fix completed. Please review changes."
fi

# Check for console.log statements in production code
echo "ğŸ” Checking for console.log statements..."
if grep -r "console\.log" --include="*.ts" --include="*.tsx" src/ | grep -v "// eslint-disable-line" | grep -v "// TODO" | grep -v "// DEBUG"; then
    echo "âš ï¸  Warning: console.log statements found in source code"
fi

# Check component sizes
echo "ğŸ“ Checking component sizes..."
for file in $(find src/components -name "*.tsx" -type f); do
    lines=$(wc -l < "$file")
    if [ $lines -gt 300 ]; then
        echo "âš ï¸  Warning: $file has $lines lines (exceeds 300 line limit)"
    fi
done

echo "âœ… Claude pre-commit checks completed!"